<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>biom.table.Table.collapse &#8212; biom-format.org</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css?v=dfa0e015" />
    <script src="../../_static/documentation_options.js?v=30ffe591"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/copybutton.js?v=1d1412a1"></script>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="biom.table.Table.concat" href="biom.table.Table.concat.html" />
    <link rel="prev" title="biom.table.Table.align_tree" href="biom.table.Table.align_tree.html" /> 
  </head><body>
  
  <a href="https://github.com/biocore/biom-format"><img
    style="position: absolute; top: 0; right: 0; border: 0;"
    src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
    alt="Fork me on GitHub"></a>

      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>biom-format.org</span></a></h1>
        <h2 class="heading"><span>biom.table.Table.collapse</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="biom.table.Table.align_tree.html">biom.table.Table.align_tree</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="biom.table.Table.concat.html">biom.table.Table.concat</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="biom-table-table-collapse">
<h1>biom.table.Table.collapse<a class="headerlink" href="#biom-table-table-collapse" title="Link to this heading">¶</a></h1>
<dl class="py method">
<dt class="sig sig-object py" id="biom.table.Table.collapse">
<span class="sig-prename descclassname"><span class="pre">Table.</span></span><span class="sig-name descname"><span class="pre">collapse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collapse_f</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_group_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_collapsed_metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">one_to_many</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">one_to_many_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'add'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">one_to_many_md_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Path'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sample'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#biom.table.Table.collapse" title="Link to this definition">¶</a></dt>
<dd><p>Collapse partitions in a table by metadata or by IDs</p>
<p>Partition data by metadata or IDs and then collapse each partition into
a single vector.</p>
<p>If <cite>include_collapsed_metadata</cite> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, the metadata for the
collapsed partition will be a category named ‘collapsed_ids’, in which
a list of the original ids that made up the partition is retained</p>
<p>The remainder is only relevant to setting <cite>one_to_many</cite> to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>If <cite>one_to_many</cite> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, allow vectors to collapse into multiple
bins if the metadata describe a one-many relationship. Supplied
functions must allow for iteration support over the metadata key and
must return a tuple of (path, bin) as to describe both the path in the
hierarchy represented and the specific bin being collapsed into. The
uniqueness of the bin is _not_ based on the path but by the name of the
bin.</p>
<p>The metadata value for the corresponding collapsed column may include
more (or less) information about the collapsed data. For example, if
collapsing “FOO”, and there are vectors that span three associations A,
B, and C, such that vector 1 spans A and B, vector 2 spans B and C and
vector 3 spans A and C, the resulting table will contain three
collapsed vectors:</p>
<ul class="simple">
<li><p>A, containing original vectors 1 and 3</p></li>
<li><p>B, containing original vectors 1 and 2</p></li>
<li><p>C, containing original vectors 2 and 3</p></li>
</ul>
<p>If a vector maps to the same partition multiple times, it will be
counted multiple times.</p>
<p>There are two supported modes for handling one-to-many relationships
via <cite>one_to_many_mode</cite>: <code class="docutils literal notranslate"><span class="pre">add</span></code> and <cite>divide</cite>. <code class="docutils literal notranslate"><span class="pre">add</span></code> will add the
vector counts to each partition that the vector maps to, which may
increase the total number of counts in the output table. <code class="docutils literal notranslate"><span class="pre">divide</span></code>
will divide a vectors’s counts by the number of metadata that the
vector has before adding the counts to each partition. This will not
increase the total number of counts in the output table.</p>
<p>If <cite>one_to_many_md_key</cite> is specified, that becomes the metadata
key that describes the collapsed path. If a value is not specified,
then it defaults to ‘Path’.</p>
<p>If <cite>strict</cite> is specified, then all metadata pathways operated on
must be indexable by <cite>metadata_f</cite>.</p>
<p><cite>one_to_many</cite> and <cite>norm</cite> are not supported together.</p>
<p><cite>one_to_many</cite> and <cite>collapse_f</cite> are not supported together.</p>
<p><cite>one_to_many</cite> and <cite>min_group_size</cite> are not supported together.</p>
<p>A final note on space consumption. At present, the <cite>one_to_many</cite>
functionality requires a temporary dense matrix representation.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl>
<dt><strong>f</strong><span class="classifier">function</span></dt><dd><p>Function that is used to determine what partition a vector belongs
to</p>
</dd>
<dt><strong>collapse_f</strong><span class="classifier">function, optional</span></dt><dd><p>Function that collapses a partition in a one-to-one collapse. The
expected function signature is:</p>
<blockquote>
<div><p>dense or sparse_vector &lt;- collapse_f(Table, axis)</p>
</div></blockquote>
<p>Defaults to a pairwise add.</p>
</dd>
<dt><strong>norm</strong><span class="classifier">bool, optional</span></dt><dd><p>Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>. If <code class="docutils literal notranslate"><span class="pre">True</span></code>, normalize the resulting table</p>
</dd>
<dt><strong>min_group_size</strong><span class="classifier">int, optional</span></dt><dd><p>Defaults to <code class="docutils literal notranslate"><span class="pre">1</span></code>. The minimum size of a partition when performing
a one-to-one collapse</p>
</dd>
<dt><strong>include_collapsed_metadata</strong><span class="classifier">bool, optional</span></dt><dd><p>Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>. If <code class="docutils literal notranslate"><span class="pre">True</span></code>, retain the collapsed metadata
keyed by the original IDs of the associated vectors</p>
</dd>
<dt><strong>one_to_many</strong><span class="classifier">bool, optional</span></dt><dd><p>Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>. Perform a one-to-many collapse</p>
</dd>
<dt><strong>one_to_many_mode</strong><span class="classifier">{‘add’, ‘divide’}, optional</span></dt><dd><p>The way to reduce two vectors in a one-to-many collapse</p>
</dd>
<dt><strong>one_to_many_md_key</strong><span class="classifier">str, optional</span></dt><dd><p>Defaults to “Path”. If <cite>include_collapsed_metadata</cite> is <code class="docutils literal notranslate"><span class="pre">True</span></code>,
store the original vector metadata under this key</p>
</dd>
<dt><strong>strict</strong><span class="classifier">bool, optional</span></dt><dd><p>Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>. Requires full pathway data within a
one-to-many structure</p>
</dd>
<dt><strong>axis</strong><span class="classifier">{‘sample’, ‘observation’}, optional</span></dt><dd><p>The axis to collapse</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><dl class="simple">
<dt>Table</dt><dd><p>The collapsed table</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">biom.table</span> <span class="kn">import</span> <span class="n">Table</span>
</pre></div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">Table</span></code></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dt_rich</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]]),</span>
<span class="gp">... </span>   <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
<span class="gp">... </span>   <span class="p">[{</span><span class="s1">&#39;taxonomy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;k__a&#39;</span><span class="p">,</span> <span class="s1">&#39;p__b&#39;</span><span class="p">]},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;taxonomy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;k__a&#39;</span><span class="p">,</span> <span class="s1">&#39;p__c&#39;</span><span class="p">]},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;taxonomy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;k__a&#39;</span><span class="p">,</span> <span class="s1">&#39;p__c&#39;</span><span class="p">]}],</span>
<span class="gp">... </span>   <span class="p">[{</span><span class="s1">&#39;barcode&#39;</span><span class="p">:</span> <span class="s1">&#39;aatt&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;barcode&#39;</span><span class="p">:</span> <span class="s1">&#39;ttgg&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;barcode&#39;</span><span class="p">:</span> <span class="s1">&#39;aatt&#39;</span><span class="p">}])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dt_rich</span><span class="p">)</span> 
<span class="go"># Constructed from biom file</span>
<span class="go">#OTU ID a   b   c</span>
<span class="go">1   5.0 6.0 7.0</span>
<span class="go">2   8.0 9.0 10.0</span>
<span class="go">3   11.0    12.0    13.0</span>
</pre></div>
</div>
<p>Create Function to determine what partition a vector belongs to</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bin_f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">id_</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;taxonomy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obs_phy</span> <span class="o">=</span> <span class="n">dt_rich</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">bin_f</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_group_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>   <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;observation&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;observation&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">obs_phy</span><span class="p">)</span> 
<span class="go"># Constructed from biom file</span>
<span class="go">#OTU ID a   b   c</span>
<span class="go">p__b    5.0 6.0 7.0</span>
<span class="go">p__c    19.0    21.0    23.0</span>
</pre></div>
</div>
</dd></dl>

</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="biom.table.Table.align_tree.html">biom.table.Table.align_tree</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="biom.table.Table.concat.html">biom.table.Table.concat</a>&#160;&#160;»
        </p>

      </div>


    <div class="footer" role="contentinfo">
    &#169; Copyright 2011-2024 The BIOM Format Development Team.
      Last updated on May 11, 2024.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6636235-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>